# Automated Email Notification System

A fully automated, modular email delivery system integrating:

- **Oracle Database (Direct Query + APEX ORDS REST API)**
- **Python Automation**
- **Zoho Mail API (OAuth2)**
- **Google SMTP (App Password)**
- **Support for Email Attachments (BLOB via REST API)**

This project demonstrates a complete real-world workflow used by enterprise systems to send automated notifications.

---

# üì¶ Project Overview

This system supports:

‚úî Sending HTML emails  
‚úî Sending emails via **Gmail SMTP**  
‚úî Sending emails via **Zoho Mail API**  
‚úî Fetching email data directly from **Oracle DB**  
‚úî Fetching email data via **APEX REST API**  
‚úî Sending **attachments** stored as BLOB in Oracle  
‚úî Easily deployable scripts  
‚úî Secure usage through `.env` configuration  

---

# üìÅ Project Structure

```
automated-email-notification-system/
‚îÇ
‚îú‚îÄ README.md
‚îú‚îÄ .env.example
‚îú‚îÄ .gitignore
‚îÇ
‚îú‚îÄ sql/
‚îÇ   ‚îú‚îÄ email_notification_table.sql
‚îÇ   ‚îî‚îÄ email_notification_blob_table.sql
‚îÇ
‚îú‚îÄ python/
‚îÇ   ‚îú‚îÄ get_zoho_tokens.py
‚îÇ   ‚îú‚îÄ get_zoho_account_id.py
‚îÇ   ‚îú‚îÄ send_gmail_from_oracle.py
‚îÇ   ‚îú‚îÄ send_zoho_from_oracle_db.py
‚îÇ   ‚îú‚îÄ send_zoho_from_rest_api.py
‚îÇ   ‚îî‚îÄ send_zoho_from_blob_rest.py
‚îÇ
‚îî‚îÄ apex/
    ‚îî‚îÄ rest_module_documentation.md
```

---

# ‚öôÔ∏è Requirements

```
Python 3.9+
Oracle Instant Client
APEX ORDS Enabled
Zoho Mail Account
Gmail Account (optional)
```

---

# üõ†Ô∏è Install Required Python Libraries

```
pip install requests oracledb python-dotenv urllib3
```

---

# üß™ SQL ‚Äî Base Email Table

This is the base table you already used:

```sql
CREATE TABLE EMAIL_NOTIFICATION (
    ID               NUMBER,
    EMAIL            VARCHAR2(320),
    CC               VARCHAR2(1000),
    BCC              VARCHAR2(1000),
    MESSAGE          VARCHAR2(4000),
    SUBJECT          VARCHAR2(500),
    ATTACHMENT_PATH  VARCHAR2(500),
    USER_ID          VARCHAR2(100),
    ENTER_DATE       DATE,
    LAST_UPDATE      DATE
);
```

---

# üß™ SQL ‚Äî BLOB Attachment Table

To store any type of file (PDF, image, docx, zip):

```sql
CREATE TABLE EMAIL_NOTIFICATION_BLOB (
    ID                  NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMAIL               VARCHAR2(320) NOT NULL,
    CC                  VARCHAR2(1000),
    BCC                 VARCHAR2(1000),
    SUBJECT             VARCHAR2(500),
    MESSAGE             VARCHAR2(4000),
    ATTACHMENT_FILENAME VARCHAR2(255),
    ATTACHMENT_MIMETYPE VARCHAR2(255),
    ATTACHMENT_BLOB     BLOB,
    USER_ID             VARCHAR2(100),
    ENTER_DATE          DATE DEFAULT SYSDATE,
    LAST_UPDATE         DATE
)
LOB (ATTACHMENT_BLOB) STORE AS SECUREFILE (
    ENABLE STORAGE IN ROW
);
```

---

# üí° Google SMTP Setup

### 1Ô∏è‚É£ Enable 2-Step Verification  
https://myaccount.google.com/security

### 2Ô∏è‚É£ Create App Password  
Go to:

**Security ‚Üí App Passwords**

Select:
- App: *Mail*
- Device: *Windows Computer*

Google generates a **16-character password**.

Use this password instead of your Gmail password.

---

# üíª Python ‚Äî Send Email via Gmail

```python
server = smtplib.SMTP("smtp.gmail.com", 587)
server.starttls()
server.login("your@gmail.com", "your_app_password")
```

---

# üí° Zoho Mail API Setup (OAuth2)

Zoho uses OAuth2 ‚Äî more secure than SMTP.

## 1Ô∏è‚É£ Create OAuth Client  
https://api-console.zoho.com/

Choose:
- Client Type: **Web-Based**
- Redirect URI: `http://localhost:8080/`

Receive:
```
client_id
client_secret
```

---

## 2Ô∏è‚É£ Generate Authorization Code

Open in browser:

```
https://accounts.zoho.com/oauth/v2/auth?
scope=ZohoMail.messages.CREATE ZohoMail.accounts.READ&
client_id=YOUR_CLIENT_ID&
response_type=code&
access_type=offline&
redirect_uri=http://localhost:8080/
```

Copy the `code=xxxxx`.

---

## 3Ô∏è‚É£ Exchange Code ‚Üí Refresh Token

```
curl --location 'https://accounts.zoho.com/oauth/v2/token' --form 'grant_type=authorization_code' --form 'client_id=xxxx' --form 'client_secret=yyyy' --form 'redirect_uri=http://localhost:8080/' --form 'code=zzzz'
```

Returns:
```
refresh_token
access_token
```

---

## 4Ô∏è‚É£ Get Zoho Account ID

```
GET https://mail.zoho.com/api/accounts
Authorization: Zoho-oauthtoken <access_token>
```

Example response:
```
"accountId":"901664000000008002",
"mailboxAddress":"user@zohomail.com"
```

---

# üì® Python ‚Äî Send Email via Zoho API

```python
url = f"https://mail.zoho.com/api/accounts/{ACCOUNT_ID}/messages"
headers = {
 "Authorization": f"Zoho-oauthtoken {access_token}",
 "Content-Type": "application/json"
}
```

---

# üî• Sending Email via APEX REST API + Zoho

Workflow:

1. APEX REST API returns email rows  
2. Python fetches JSON list  
3. Python loops through rows  
4. Sends each email through Zoho API  

Script:  
`python/send_zoho_from_rest_api.py`

---

# üî• Send Attachment via BLOB REST API

Full flow:

1. Oracle table stores file in BLOB  
2. ORDS REST endpoint returns Base64 BLOB  
3. Python decodes Base64  
4. Temporary file created  
5. File sent using Zoho multipart upload  

Script:  
`python/send_zoho_from_blob_rest.py`

---

# ‚ñ∂Ô∏è How to Run

### 1. Copy `.env.example` ‚Üí `.env`
Fill:

```
ZOHO_CLIENT_ID=
ZOHO_CLIENT_SECRET=
ZOHO_REFRESH_TOKEN=
ZOHO_ACCOUNT_ID=
ZOHO_FROM_ADDRESS=
APEX_EMAIL_API_URL=
```

### 2. Run the script

```
python python/send_zoho_from_rest_api.py
```

Or with attachments:

```
python python/send_zoho_from_blob_rest.py
```

---

# üèÅ Conclusion

This project demonstrates real-world enterprise automation:

- Oracle DB Integration  
- APEX REST API Development  
- OAuth2 Token Handling  
- Zoho Mail API Messaging  
- Gmail SMTP Automation  
- Attachment Handling  
- Modular Clean Code  

---

# üë§ Author

Developed by **Nayan Das**, integrating Oracle APEX + Python + Zoho Mail into a production-ready workflow.